<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Drools Course by vincentjwang</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Drools Course</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/vincentjwang/droolscourse" class="btn">View on GitHub</a>
      <a href="https://github.com/vincentjwang/droolscourse/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/vincentjwang/droolscourse/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="drools介绍和环境搭建" class="anchor" href="#drools%E4%BB%8B%E7%BB%8D%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" aria-hidden="true"><span class="octicon octicon-link"></span></a>Drools介绍和环境搭建</h1>

<p>关于Drools的介绍，我们看下官网的描述：</p>

<blockquote>
<p>Drools is a Business Rules Management System (BRMS) solution. It provides a core Business Rules Engine (BRE), a web authoring and rules management application (Drools Workbench) and an Eclipse IDE plugin for core development.</p>
</blockquote>

<p>Drools是一个业务规则管理系统解决方案。它提供一整套核心业务规则引擎(BRE)，Web验证规则管理应用(Drools Workbench)和Eclipse IDE插件。我们用到的只是解决方案中的规则引擎部分，它允许开发人员将业务规则以规则文件的形式存储，这样业务改变只需要修改规则文件，不需要修改代码部署版本即可完成业务的引入或变更。</p>

<h2>
<a id="drools安装" class="anchor" href="#drools%E5%AE%89%E8%A3%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>Drools安装</h2>

<p>Drools的开发环境搭建通常有两种方式，本人亲测两种都能安装成功，不过个人更倾向于第一种，也是官方推荐的方法。</p>

<h3>
<a id="基础环境" class="anchor" href="#%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>基础环境</h3>

<ul>
<li>OS: Ubuntu10.10</li>
<li>JRE version: 1.8.0_45</li>
<li>IDE: Eclipse</li>
</ul>

<h3>
<a id="installation-method-1---eclipse-install-new-software" class="anchor" href="#installation-method-1---eclipse-install-new-software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation Method 1 - Eclipse install new software</h3>

<p>到Drools下载页面(<a href="http://www.jboss.org/drools/downloads.html">http://www.jboss.org/drools/downloads.html</a>)
-下载并解压Drools：drools-distribution-5.5.0.Final.zip  (解压目录随意)
-下载并解压插件：droolsjbpm-tools-distribution-5.5.0.Final.zip(解压目录随意)</p>

<ul>
<li>打开 Eclipse.</li>
<li>点 "Help"—"Install new software..."</li>
<li>点击 "Add..."<br>
</li>
<li>在name中输入"Drools5.5"(名字随意起)</li>
<li>点击 "Local..." 并且选择"......./binaries/org.drools.updatesite" (此目录在刚刚解压的插件中)</li>
<li>点击OK</li>
<li>选择所以插件。
-下面就是点击next，finish</li>
</ul>

<p>插件安装完后还需在Eclipse中添加Drools的运行环境：</p>

<ul>
<li>点击"Windows"—"Preferencess"</li>
<li>在窗口的树形菜单中选择"Drools"—"Installed Drools Runtimes"</li>
<li>在右边的空的Drools运行库列表中，点击"Add"</li>
<li>在弹出窗口中name输入Drools5.5 Runtime(随意起个名字)，在Path选择"......./drools-distribution-5.5.0.Final/drools-distribution-5.5.0.Final/binaries" (此目录在刚刚解压的Drools中)，</li>
<li>点击"OK"</li>
<li>点击"OK"</li>
</ul>

<h3>
<a id="installation-method-2---plugins-link" class="anchor" href="#installation-method-2---plugins-link" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation Method 2 - Plugins link</h3>

<p>下载Method1中的两个压缩包</p>

<ul>
<li>在Eclipse安装目录下创建两个文件links, myPlugins(名字随意)</li>
<li>在myplugin下新建一个drools文件夹。。将以解压后的文件的上一层目录下features,plugins 复制到里面</li>
<li>在 links 目录下创建一个 drools.txt(名字随意)，打开并输入：path=(Eclipse路径)\eclipse\myplugins\drools</li>
<li>保存关闭 drools.txt，并将后缀改成 drools.link，重启 eclipse</li>
<li>安装运行时方式如Method 1</li>
</ul>

<h2>
<a id="示例程序" class="anchor" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>示例程序</h2>

<p>打开Eclipse -&gt; File -&gt; New -&gt; Drools Project，输入项目名后会有示例程序的选项，先全部勾选上吧。
可以看到生成的项目里包含了很多文件，我们暂时先不用理清每个文件的含义，重点关注src/main/java/com.sample/DroolsTest.java和src/main/rules/Sample.drl</p>

<p>DroolsTest.java</p>

<div class="highlight highlight-java"><pre><span class="pl-k">package</span> <span class="pl-smi">com.sample</span>;

<span class="pl-k">import</span> <span class="pl-smi">org.drools.KnowledgeBase</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.KnowledgeBaseFactory</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.builder.KnowledgeBuilder</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.builder.KnowledgeBuilderError</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.builder.KnowledgeBuilderErrors</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.builder.KnowledgeBuilderFactory</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.builder.ResourceType</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.io.ResourceFactory</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.logger.KnowledgeRuntimeLogger</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.logger.KnowledgeRuntimeLoggerFactory</span>;
<span class="pl-k">import</span> <span class="pl-smi">org.drools.runtime.StatefulKnowledgeSession</span>;

<span class="pl-c">/**</span>
<span class="pl-c"> * This is a sample class to launch a rule.</span>
<span class="pl-c"> */</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">DroolsTest</span> {

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
        <span class="pl-k">try</span> {
            <span class="pl-c">// load up the knowledge base</span>
            <span class="pl-smi">KnowledgeBase</span> kbase <span class="pl-k">=</span> readKnowledgeBase();
            <span class="pl-smi">StatefulKnowledgeSession</span> ksession <span class="pl-k">=</span> kbase<span class="pl-k">.</span>newStatefulKnowledgeSession();
            <span class="pl-smi">KnowledgeRuntimeLogger</span> logger <span class="pl-k">=</span> <span class="pl-smi">KnowledgeRuntimeLoggerFactory</span><span class="pl-k">.</span>newFileLogger(ksession, <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>);
            <span class="pl-c">// go !</span>
            <span class="pl-smi">Message</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Message</span>();
            message<span class="pl-k">.</span>setMessage(<span class="pl-s"><span class="pl-pds">"</span>Hello World<span class="pl-pds">"</span></span>);
            message<span class="pl-k">.</span>setStatus(<span class="pl-smi">Message</span><span class="pl-c1"><span class="pl-k">.</span>HELLO</span>);
            ksession<span class="pl-k">.</span>insert(message);
            ksession<span class="pl-k">.</span>fireAllRules();
            logger<span class="pl-k">.</span>close();
        } <span class="pl-k">catch</span> (<span class="pl-smi">Throwable</span> t) {
            t<span class="pl-k">.</span>printStackTrace();
        }
    }

    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-smi">KnowledgeBase</span> <span class="pl-en">readKnowledgeBase</span>() <span class="pl-k">throws</span> <span class="pl-smi">Exception</span> {
        <span class="pl-smi">KnowledgeBuilder</span> kbuilder <span class="pl-k">=</span> <span class="pl-smi">KnowledgeBuilderFactory</span><span class="pl-k">.</span>newKnowledgeBuilder();
        kbuilder<span class="pl-k">.</span>add(<span class="pl-smi">ResourceFactory</span><span class="pl-k">.</span>newClassPathResource(<span class="pl-s"><span class="pl-pds">"</span>Sample.drl<span class="pl-pds">"</span></span>), <span class="pl-smi">ResourceType</span><span class="pl-c1"><span class="pl-k">.</span>DRL</span>);
        <span class="pl-smi">KnowledgeBuilderErrors</span> errors <span class="pl-k">=</span> kbuilder<span class="pl-k">.</span>getErrors();
        <span class="pl-k">if</span> (errors<span class="pl-k">.</span>size() <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
            <span class="pl-k">for</span> (<span class="pl-smi">KnowledgeBuilderError</span> error<span class="pl-k">:</span> errors) {
                <span class="pl-smi">System</span><span class="pl-k">.</span>err<span class="pl-k">.</span>println(error);
            }
            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">IllegalArgumentException</span>(<span class="pl-s"><span class="pl-pds">"</span>Could not parse knowledge.<span class="pl-pds">"</span></span>);
        }
        <span class="pl-smi">KnowledgeBase</span> kbase <span class="pl-k">=</span> <span class="pl-smi">KnowledgeBaseFactory</span><span class="pl-k">.</span>newKnowledgeBase();
        kbase<span class="pl-k">.</span>addKnowledgePackages(kbuilder<span class="pl-k">.</span>getKnowledgePackages());
        <span class="pl-k">return</span> kbase;
    }

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">Message</span> {

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">int</span> <span class="pl-c1">HELLO</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;
        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">int</span> <span class="pl-c1">GOODBYE</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>;

        <span class="pl-k">private</span> <span class="pl-smi">String</span> message;

        <span class="pl-k">private</span> <span class="pl-k">int</span> status;

        <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getMessage</span>() {
            <span class="pl-k">return</span> <span class="pl-v">this</span><span class="pl-k">.</span>message;
        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setMessage</span>(<span class="pl-smi">String</span> <span class="pl-v">message</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>message <span class="pl-k">=</span> message;
        }

        <span class="pl-k">public</span> <span class="pl-k">int</span> <span class="pl-en">getStatus</span>() {
            <span class="pl-k">return</span> <span class="pl-v">this</span><span class="pl-k">.</span>status;
        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setStatus</span>(<span class="pl-k">int</span> <span class="pl-v">status</span>) {
            <span class="pl-v">this</span><span class="pl-k">.</span>status <span class="pl-k">=</span> status;
        }

    }

}</pre></div>

<p>Sample.drl</p>

<div class="highlight highlight-java"><pre><span class="pl-k">package</span> <span class="pl-smi">com.sample</span>

<span class="pl-k">import</span> <span class="pl-smi">com.sample.DroolsTest.Message</span>;

rule <span class="pl-s"><span class="pl-pds">"</span>Hello World<span class="pl-pds">"</span></span>
    when
        $m <span class="pl-k">:</span> Message( status <span class="pl-k">==</span> <span class="pl-smi">Message</span><span class="pl-c1"><span class="pl-k">.</span>HELLO</span>, $myMessage <span class="pl-k">:</span> message )
    then
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println( $myMessage );
        $m<span class="pl-k">.</span>setMessage( <span class="pl-s"><span class="pl-pds">"</span>Goodbye cruel worlds<span class="pl-pds">"</span></span> );
        $m<span class="pl-k">.</span>setStatus( <span class="pl-smi">Message</span><span class="pl-c1"><span class="pl-k">.</span>GOODBYE</span> );
        update( $m );
end

rule <span class="pl-s"><span class="pl-pds">"</span>GoodBye<span class="pl-pds">"</span></span>
    when
        Message( status <span class="pl-k">==</span> <span class="pl-smi">Message</span><span class="pl-c1"><span class="pl-k">.</span>GOODBYE</span>, $myMessage <span class="pl-k">:</span> message )
    then
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println( $myMessage );
end</pre></div>

<p>运行下试试看，可以看到控制台输出了</p>

<p>Hello World   </p>

<p>Goodbye cruel worlds   </p>

<p>可以看到我们并没有在java代码里写业务逻辑代码，业务都是包含在规则中的，这就是规则引擎的功劳了，以后的章节我们会详细分析。</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/vincentjwang/droolscourse">Drools Course</a> is maintained by <a href="https://github.com/vincentjwang">vincentjwang</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

